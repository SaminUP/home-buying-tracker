<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Home-Buying Budget Tracker</title>
  <style>
    :root{--bg:#0f172a;--card:#0b1220;--accent:#7dd3fc;--muted:#94a3b8;--glass: rgba(255,255,255,0.03)}
    *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,Helvetica,Arial}
    body{margin:0;min-height:100vh;background:linear-gradient(180deg,#020617 0%, #081028 100%);color:#e6eef8;display:flex;align-items:center;justify-content:center;padding:28px}
    .app{width:100%;max-width:1100px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    header h1{font-size:20px;margin:0}
    .controls{display:flex;gap:12px;align-items:center}
    input[type=number]{width:170px;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 6px 18px rgba(2,6,23,0.6)}

    .layout{display:grid;grid-template-columns:1fr 420px;gap:18px}

    /* sliders area */
    .sliders{display:flex;gap:18px;align-items:end;justify-content:center;padding:12px}
    .fader{width:86px;display:flex;flex-direction:column;align-items:center}
    .fader label{font-size:13px;margin-bottom:10px;text-align:center;color:var(--muted)}
    .fader .value{margin-top:10px;font-weight:600}

    /* make horizontal range look vertical */
    input[type=range]{appearance:none;width:180px;height:6px;transform:rotate(-90deg);margin:0;padding:0}
    input[type=range]::-webkit-slider-runnable-track{height:6px;border-radius:6px;background:linear-gradient(90deg,#0ea5e9 0%, #06b6d4 100%)}
    input[type=range]::-webkit-slider-thumb{appearance:none;width:18px;height:18px;border-radius:50%;background:#fff;border:4px solid rgba(0,0,0,0.2);transform:translateY(-6px)}
    input[type=range]:focus{outline:none}

    /* meter */
    .summary{display:flex;flex-direction:column;gap:12px}
    .totals{display:flex;justify-content:space-between;align-items:center}
    .pie{height:200px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));display:flex;align-items:center;justify-content:center}

    .list{display:grid;gap:8px}
    .list .row{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:8px;background:var(--glass)}
    .row small{color:var(--muted)}

    .footer{display:flex;gap:8px;justify-content:flex-end;margin-top:10px}
    button{padding:8px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;cursor:pointer}
    button.primary{background:linear-gradient(90deg,#06b6d4,#0ea5e9);color:#05202a;border:none}

    @media (max-width:900px){
      .layout{grid-template-columns:1fr;}
      .sliders{overflow-x:auto;padding-bottom:8px}
    }

    /* accessibility */
    .sr-only{position:absolute;left:-9999px}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Home-Buying Budget Tracker</h1>
      <div class="controls">
        <label for="budget">Total budget (£)</label>
        <input id="budget" type="number" min="0" step="100" value="200000">
        <button id="reset">Reset</button>
        <button id="export">Export JSON</button>
      </div>
    </header>

    <div class="layout">
      <section class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h2 style="margin:0;font-size:16px">Allocate funds</h2>
          <div style="font-size:13px;color:var(--muted)">Drag the dials — totals always match budget</div>
        </div>

        <div class="sliders" id="sliders"></div>
      </section>

      <aside class="card summary">
        <div class="totals">
          <div>
            <div style="font-size:13px;color:var(--muted)">Budget</div>
            <div style="font-weight:700;font-size:20px" id="budgetDisplay">£200,000.00</div>
          </div>
          <div style="text-align:right">
            <div style="font-size:13px;color:var(--muted)">Allocated</div>
            <div style="font-weight:700;font-size:20px" id="allocatedDisplay">£200,000.00</div>
          </div>
        </div>

        <div class="pie" id="pieArea">
          <svg id="pie" width="180" height="180" viewBox="0 0 32 32"></svg>
        </div>

        <div class="list" id="list"></div>

        <div class="footer">
          <button id="equalize">Evenly split</button>
          <button class="primary" id="commit">Lock allocations</button>
        </div>
      </aside>
    </div>

    <p style="margin-top:12px;color:var(--muted);font-size:13px">Categories: kitchen, bathroom, bedrooms, flooring, walls, other</p>
  </div>

<script>
const categories = ["kitchen","bathroom","bedrooms","flooring","walls","other"];
const slidersEl = document.getElementById('sliders');
const budgetInput = document.getElementById('budget');
const budgetDisplay = document.getElementById('budgetDisplay');
const allocatedDisplay = document.getElementById('allocatedDisplay');
const listEl = document.getElementById('list');
const pieSvg = document.getElementById('pie');
let percents = [], locked=false;

function fmt(n){return '£' + n.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2})}

function init(){
  // start with equal distribution
  const equal = 100 / categories.length;
  percents = categories.map(()=>equal);
  renderSliders();
  renderAll();
}

function renderSliders(){
  slidersEl.innerHTML='';
  categories.forEach((cat,i)=>{
    const f = document.createElement('div'); f.className='fader card';
    f.innerHTML = `
      <label for="s${i}">${cat}</label>
      <input type="range" id="s${i}" min="0" max="100" step="0.1" value="${percents[i].toFixed(2)}">
      <div class="value"><div><strong id="p${i}">${percents[i].toFixed(1)}%</strong></div><div style="font-size:13px;color:var(--muted)" id="a${i}\"></div></div>
    `;
    slidersEl.appendChild(f);
    const input = f.querySelector('input');
    input.addEventListener('input', e=>onSliderInput(i, parseFloat(e.target.value)));
    input.addEventListener('change', e=>onSliderChange(i, parseFloat(e.target.value)));
  });
}

function onSliderInput(index,newPct){
  if(locked) return;
  redistribute(index,newPct);
  renderAll();
}

function onSliderChange(index,newPct){
  // snap to 1 decimal maybe
  redistribute(index,Math.round(newPct*10)/10);
  renderAll();
}

function redistribute(index,newPct){
  newPct = Math.max(0, Math.min(100, newPct));
  const prev = percents[index];
  if(Math.abs(newPct - prev) < 1e-6) return;
  const othersPrevSum = 100 - prev;
  const remaining = Math.max(0, 100 - newPct);
  if(othersPrevSum > 0){
    // scale others proportionally so their sum becomes `remaining`
    const scale = remaining / othersPrevSum;
    percents = percents.map((v,i)=> i===index ? newPct : (v*scale));
  } else {
    // all others were zero; distribute remaining equally
    const each = remaining / (percents.length -1);
    percents = percents.map((v,i)=> i===index ? newPct : each);
  }
  // fix tiny numerical rounding issues by normalizing to 100
  normalizePercents();
}

function normalizePercents(){
  let sum = percents.reduce((a,b)=>a+b,0);
  if(Math.abs(sum - 100) > 1e-8){
    percents = percents.map(p => p * (100 / sum));
  }
}

function renderAll(){
  const budget = parseFloat(budgetInput.value) || 0;
  budgetDisplay.textContent = fmt(budget);
  // update sliders values and amounts
  percents.forEach((p,i)=>{
    const input = document.getElementById('s'+i);
    if(input){ input.value = p.toFixed(2); }
    document.getElementById('p'+i).textContent = p.toFixed(1) + '%';
    const amt = budget * p / 100;
    document.getElementById('a'+i).textContent = fmt(amt);
  });

  // update list
  listEl.innerHTML = '';
  let allocated = 0;
  percents.forEach((p,i)=>{
    const amt = budget * p / 100;
    allocated += amt;
    const row = document.createElement('div'); row.className='row';
    row.innerHTML = `<div><strong>${categories[i]}</strong><div style='font-size:12px;color:var(--muted)'>${p.toFixed(1)}%</div></div><div style='text-align:right'><div><strong>${fmt(amt)}</strong></div><small>${p.toFixed(1)}%</small></div>`;
    listEl.appendChild(row);
  });
  allocatedDisplay.textContent = fmt(allocated);
  drawPie();
}

function drawPie(){
  // simple pie using stroke-dasharray on circle (donut)
  const radi = 16; // viewbox 0..32
  pieSvg.innerHTML = '';
  let start = 0;
  const colors = ['#06b6d4','#7dd3fc','#60a5fa','#34d399','#f59e0b','#f472b6'];
  percents.forEach((p,i)=>{
    if(p<=0.0001) return;
    const portion = p/100;
    const dash = portion * 31.4159; // 2*pi*r where r=5? we'll scale differently
    // We'll create arcs using circle stroke technique on same circle sized to 32 viewBox
    const circle = document.createElementNS('http://www.w3.org/2000/svg','circle');
    circle.setAttribute('r','10.5');
    circle.setAttribute('cx','16');
    circle.setAttribute('cy','16');
    circle.setAttribute('fill','transparent');
    circle.setAttribute('stroke',colors[i%colors.length]);
    circle.setAttribute('stroke-width','7');
    circle.setAttribute('stroke-dasharray', (portion*66).toString() + ' 66');
    circle.setAttribute('transform','rotate(-90 16 16)');
    circle.setAttribute('stroke-dashoffset', (-start*66).toString());
    pieSvg.appendChild(circle);
    start += portion;
  });
}

budgetInput.addEventListener('change',()=>{
  // when total budget changes, amounts update but percentages remain
  renderAll();
});

document.getElementById('reset').addEventListener('click',()=>{
  const equal = 100 / categories.length;
  percents = categories.map(()=>equal);
  budgetInput.value = 200000;
  renderAll();
});

document.getElementById('equalize').addEventListener('click',()=>{
  const equal = 100 / categories.length;
  percents = categories.map(()=>equal);
  renderAll();
});

document.getElementById('commit').addEventListener('click', ()=>{
  locked = !locked;
  document.getElementById('commit').textContent = locked ? 'Unlock allocations' : 'Lock allocations';
  document.getElementById('commit').classList.toggle('primary', locked);
});

document.getElementById('export').addEventListener('click', ()=>{
  const budget = parseFloat(budgetInput.value) || 0;
  const out = categories.map((c,i)=>({category:c,percent:parseFloat(percents[i].toFixed(3)),amount:parseFloat((budget*percents[i]/100).toFixed(2))}));
  const dataStr = JSON.stringify({budget,out},null,2);
  const blob = new Blob([dataStr],{type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'budget-allocations.json'; a.click(); URL.revokeObjectURL(url);
});

// initialize
init();
</script>
</body>
</html>
